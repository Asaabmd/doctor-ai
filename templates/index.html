<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Doctor AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f8ff;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header img {
      height: 60px;
    }

    h2 {
      text-align: center;
      color: #004d99;
    }

    .info-box {
      background-color: #e6f0ff;
      border-left: 5px solid #004d99;
      padding: 15px;
      margin-top: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
    }

    .section {
      margin-bottom: 15px;
    }

    label {
      font-weight: bold;
    }

    textarea, input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      box-sizing: border-box;
    }

    .mic-button {
      margin-top: 5px;
      background-color: #cce5ff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      cursor: pointer;
    }

    .submit-btn {
      background-color: #007bff;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .modal {
      background: #e6f0ff;
      border: 1px solid #99c2ff;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const inputs = Array.from(document.querySelectorAll("input, select, textarea"));
      inputs.forEach((el, idx) => {
        el.addEventListener("keydown", function(e) {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            const next = inputs[idx + 1];
            if (next) next.focus();
          }
        });
      });
    });

    function startDictation(button) {
      const field = button.previousElementSibling;
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'en-US';
      recognition.onresult = function(event) {
        field.value += event.results[0][0].transcript;
        field.focus();
      };
      recognition.start();
    }
  </script>
</head>
<body>

  <div class="header">
    <img src="/static/doctor.jpeg" alt="Doctor">
    <img src="/static/logo.png" alt="Logo">
  </div>

  <h2>Doctor AI</h2>

  <div class="info-box">
    <p><strong>Doctor AI</strong> is an educational tool designed to help you better understand your symptoms and medical condition by generating a personalized health summary based on the information you provide. It is not a replacement for professional medical care—always consult a physician for medical concerns.</p>
    <p>This one-time session includes a customized summary and one follow-up question to demonstrate the tool’s capabilities. Subscribing unlocks unlimited access for ongoing health insights and support.</p>
    <p>✅ Please complete all fields to receive your summary. After clicking Submit, please wait a few moments while your personalized summary is generated. You may type into each field or click the 🎤 microphone button to use voice input.</p>
  </div>

  <form method="POST">

    <div class="section">
      <label for="email">Your Email (required):</label>
      <input type="email" name="email" required>
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="symptoms">Describe your symptoms in detail. The more details you provide the more customized your summary:</label>
      <textarea name="symptoms" rows="3" required></textarea>
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="existing_conditions">Existing conditions (What are your current medical conditions):</label>
      <input type="text" name="existing_conditions">
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="allergies">Allergies (Allergies to medications, food, or other items. If none, enter 'None'):</label>
      <input type="text" name="allergies">
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="medications">Current medications (What medications do you take?):</label>
      <input type="text" name="medications">
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="onset">When did it start? (When did your current symptoms start?)</label>
      <input type="text" name="onset">
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="better">What makes it better? (If not sure, enter 'NA'):</label>
      <input type="text" name="better">
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="worse">What makes it worse? (If not sure, enter 'NA'):</label>
      <input type="text" name="worse">
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="severity">Severity (1–10) (10 is the most severe):</label>
      <input type="text" name="severity">
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="treatments">What have you tried? (What medications or remedies have you tried?):</label>
      <input type="text" name="treatments">
      <button type="button" class="mic-button" onclick="startDictation(this)">🎤</button>
    </div>

    <div class="section">
      <label for="age_range">Age Range:</label>
      <select name="age_range">
        <option value="0-12">0–12</option>
        <option value="13-19">13–19</option>
        <option value="20-40">20–40</option>
        <option value="41-60">41–60</option>
        <option value="61+">61+</option>
      </select>
    </div>

    <div class="section">
      <label for="sex">Sex/Gender:</label>
      <select name="sex">
        <option value="female">Female</option>
        <option value="male">Male</option>
        <option value="other">Other</option>
      </select>
    </div>

    <p><strong>🔔 Reminder:</strong> Please complete all fields and wait a few moments after clicking Submit to receive your customized report.</p>
    <button type="submit" class="submit-btn">Submit</button>
  </form>

  {% if response %}
  <div class="modal">
    <h3>📝 Doctor AI Summary:</h3>
    <p>{{ response | safe }}</p>

    <form method="POST" action="/followup">
      <label for="followup">Have a follow-up question?</label>
      <textarea name="followup" rows="2" placeholder="Ask your follow-up..." required></textarea>
      <button class="submit-btn" type="submit">Submit Follow-up Question</button>
    </form>
  </div>
  {% endif %}

</body>
</html>