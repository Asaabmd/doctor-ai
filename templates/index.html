<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Doctor AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f0f8ff;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header img {
      height: 60px;
    }

    h2 {
      text-align: center;
      color: #004d99;
      margin-top: 10px;
    }

    .info-box {
      background-color: #e6f0ff;
      border-left: 5px solid #004d99;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
    }

    .section {
      margin-bottom: 15px;
    }

    textarea, input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      box-sizing: border-box;
    }

    .mic-button {
      margin-top: 5px;
      background-color: #cce5ff;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
      cursor: pointer;
    }

    .submit-btn {
      background-color: #007bff;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .submit-btn:hover {
      background-color: #0056b3;
    }

    .modal {
      background: #e6f0ff;
      border: 1px solid #99c2ff;
      padding: 20px;
      border-radius: 6px;
      margin-top: 20px;
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const inputs = Array.from(document.querySelectorAll("input, select, textarea"));
      inputs.forEach((el, idx) => {
        el.addEventListener("keydown", function(e) {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            const next = inputs[idx + 1];
            if (next) next.focus();
          }
        });
      });
    });

    function startDictation(button) {
      const field = button.previousElementSibling;
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'en-US';
      recognition.onresult = function(event) {
        field.value += event.results[0][0].transcript;
        field.focus();
      };
      recognition.start();
    }
  </script>
</head>
<body>

  <div class="header">
    <img src="/static/doctor.jpeg" alt="Doctor">
    <img src="/static/logo.png" alt="Logo">
  </div>

  <h2>Doctor AI</h2>

  <div class="info-box">
    <p><strong>Doctor AI</strong> is an educational tool designed to help you better understand your symptoms and medical condition by generating a personalized health summary based on the information you provide. It is not a replacement for professional medical careâ€”always consult a physician for medical concerns.</p>

    <p>This one-time session includes a customized summary and one follow-up question to demonstrate the toolâ€™s capabilities. Subscribing unlocks unlimited access for ongoing health insights and support.</p>

    <p>âœ… <strong>Please complete all fields</strong> to receive your summary. After clicking <strong>Submit</strong>, please wait a few moments while your personalized summary is generated.</p>
  </div>

  <form method="POST">
    {% for field, label in [
      ('symptoms', 'Describe your symptoms:'),
      ('existing_conditions', 'Existing conditions:'),
      ('allergies', 'Allergies:'),
      ('medications', 'Current medications:'),
      ('onset', 'When did it start?'),
      ('better', 'What makes it better?'),
      ('worse', 'What makes it worse?'),
      ('severity', 'Severity (1â€“10):'),
      ('treatments', 'What have you tried?'),
      ('email', 'Your Email:')
    ] %}
      <div class="section">
        <label for="{{ field }}">{{ label }}</label>
        {% if field == 'symptoms' %}
          <textarea name="{{ field }}" rows="3" required></textarea>
        {% elif field == 'email' %}
          <input type="email" name="{{ field }}" required>
        {% else %}
          <input type="text" name="{{ field }}">
        {% endif %}
        <button type="button" class="mic-button" onclick="startDictation(this)">ðŸŽ¤</button>
      </div>
    {% endfor %}

    <div class="section">
      <label for="age_range">Age Range:</label>
      <select name="age_range">
        <option value="skip">Prefer not to say</option>
        <option value="0-12">0â€“12</option>
        <option value="13-19">13â€“19</option>
        <option value="20-40">20â€“40</option>
        <option value="41-60">41â€“60</option>
        <option value="61+">61+</option>
      </select>
    </div>

    <div class="section">
      <label for="sex">Sex/Gender:</label>
      <select name="sex">
        <option value="skip">Prefer not to say</option>
        <option value="female">Female</option>
        <option value="male">Male</option>
        <option value="other">Other</option>
      </select>
    </div>

    <p><strong>ðŸ”” Reminder:</strong> Please complete all fields and wait a few moments after clicking Submit to receive your customized report.</p>
    <button type="submit" class="submit-btn">Submit</button>
  </form>

  {% if response %}
    <div class="modal">
      <strong style="font-size: 18px;">Doctor AI Summary:</strong>
      <p>{{ response | safe }}</p>

      <form method="POST" action="/followup">
        <label for="followup">Have a follow-up question?</label>
        <textarea name="followup" rows="2" placeholder="Ask your follow-up..." required></textarea>
        <button class="submit-btn" type="submit">Submit Follow-up Question</button>
      </form>
    </div>
  {% endif %}

</body>
</html>