
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Doctor AI – Summary</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f8ff; margin: 0; padding: 0; color: #222; }
    .top-bar { display: flex; justify-content: space-between; align-items: center; background: #d9ecff; padding: 1rem; }
    .top-bar img { height: 60px; border-radius: 12px; }
    .container { max-width: 800px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 0 12px rgba(0, 0, 0, 0.1); }
    h1 { text-align: center; color: #0366d6; margin-top: 0; }
    h3 { color: #024ea2; margin-bottom: 0.5rem; }
    .section { margin-top: 2rem; }
    textarea, input[type="text"] { width: 100%; padding: 0.75rem; margin-top: 0.5rem; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; }
    button { background: #0366d6; color: white; border: none; padding: 0.75rem 1.5rem; font-size: 1rem; border-radius: 6px; cursor: pointer; margin-top: 1rem; }
    button:hover { background: #024ea2; }
    .mic-button { position: absolute; right: 12px; top: 42px; background: none; border: none; font-size: 1.3rem; cursor: pointer; }
    .relative { position: relative; }
    .response-box { background: #eef6ff; padding: 1rem; border-left: 4px solid #0366d6; margin-top: 1rem; border-radius: 6px; white-space: pre-wrap; }
    .label { font-weight: bold; margin-top: 1rem; display: block; }
    .sub-status { font-weight: bold; margin-bottom: 1rem; padding: 0.75rem; border-radius: 6px; }
    .subscribed { background: #e6ffed; color: #065f46; border-left: 5px solid #10b981; }
    .unsubscribed { background: #fff7ed; color: #92400e; border-left: 5px solid #f97316; }
    .link-box { margin-top: 2rem; padding: 1rem; text-align: center; }
    .link-box a { color: #0366d6; text-decoration: underline; font-weight: bold; }
    @media (max-width: 600px) {
      .top-bar { flex-direction: column; gap: 0.5rem; }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <img src="/static/doctor.jpeg" alt="Doctor" />
    <img src="/static/logo.png" alt="Logo" />
  </div>
  <div class="container">
    <h1>🧠 Doctor AI Summary</h1>
    {% if is_subscribed %}
      <div class="sub-status subscribed">✅ You are subscribed: Unlimited use</div>
    {% else %}
      <div class="sub-status unsubscribed">
        🔒 You are on the free plan: One summary and one follow-up only.<br />
        🚀 <a href="https://payhip.com/b/Da82I">Click here to subscribe for unlimited access</a>
      </div>
    {% endif %}
    <div class="section">
      <h3>📋 Your Educational Health Summary</h3>
      <div class="response-box">{{ response | safe }}</div>
    </div>
    <div class="section">
      <h3>❓ Have a Follow-Up Question?</h3>
      <form method="POST">
        <label class="label" for="followup">Ask a question about your summary:</label>
        <div class="relative">
          <input type="text" name="followup" id="followup" placeholder="e.g. What are the warning signs I should watch for?" required />
          <button class="mic-button" type="button" onclick="startDictation()">🎤</button>
        </div>
        <button type="submit">Submit Follow-Up</button>
      </form>
      {% if followup_response %}
        <div class="response-box"><strong>🔁 Response:</strong><br>{{ followup_response | safe }}</div>
        <div class="link-box">
          {% if is_subscribed %}
            🔁 <a href="{{ url_for('index') }}">Start a new symptom entry</a>
          {% else %}
            🔒 <a href="https://payhip.com/b/Da82I">Subscribe now for more follow-up access</a>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
  <script>
    window.onload = () => { document.getElementById("followup").focus(); }
    function startDictation() {
      if (!('webkitSpeechRecognition' in window)) { alert("Speech recognition not supported."); return; }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = "en-US"; recognition.interimResults = false; recognition.maxAlternatives = 1;
      recognition.onresult = (event) => {
        document.getElementById("followup").value = event.results[0][0].transcript;
      };
      recognition.onerror = (event) => { alert("Speech recognition error: " + event.error); };
      recognition.start();
    }
  </script>
</body>
</html>
